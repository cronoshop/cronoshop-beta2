<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronoshop Navigation</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar" id="mainNavbar">
        <div class="nav-content">
            <a href="index.html" class="nav-logo">
                <img src="assets/cronoshop-logo.png" alt="Cronoshop" class="logo-light">
                <img src="assets/cronoshop-logo-black.png" alt="Cronoshop" class="logo-dark" style="display: none;">
                <span>Cronoshop</span>
            </a>
            
            <div class="nav-desktop">
                <a href="index.html" class="nav-link" data-page="index">
                    <i class="ph ph-house"></i> Home
                </a>
                <a href="products.html" class="nav-link" data-page="products">
                    <i class="ph ph-package"></i> Prodotti
                </a>
                <a href="categorie.html" class="nav-link" data-page="categorie">
                    <i class="ph ph-folders"></i> Categorie
                </a>
                <a href="cronoai.html" class="nav-link" data-page="cronoai">
                    <i class="ph ph-sparkle"></i> CronoAI
                </a>
                <a href="blog.html" class="nav-link" data-page="blog">
                    <i class="ph ph-newspaper"></i> Blog
                </a>
            </div>
            
            <div class="nav-actions">
                <button class="nav-button" id="themeToggle" aria-label="Cambia tema">
                    <i class="ph ph-moon" id="themeIcon"></i>
                </button>
                <button class="nav-button" id="searchBtn" aria-label="Cerca">
                    <i class="ph ph-magnifying-glass"></i>
                </button>
                <a href="cart.html" class="nav-button" aria-label="Carrello">
                    <i class="ph ph-shopping-cart"></i>
                    <span class="cart-badge" id="cartBadge" style="
                        position: absolute;
                        top: -2px;
                        right: -2px;
                        background: var(--ios-red);
                        color: white;
                        border-radius: var(--radius-full);
                        font-size: 10px;
                        font-weight: 600;
                        min-width: 16px;
                        height: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 0 4px;
                        display: none;
                    ">0</span>
                </a>
                <a href="account.html" class="nav-button" aria-label="Account">
                    <i class="ph ph-user-circle"></i>
                </a>
                <button class="nav-button mobile-menu-btn" id="mobileMenuBtn" aria-label="Menu">
                    <i class="ph ph-list"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <span class="mobile-menu-title">Menu</span>
            <button class="nav-button" id="closeMobileMenu" aria-label="Chiudi menu">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="mobile-menu-content">
            <ul class="mobile-nav-list">
                <li class="mobile-nav-item">
                    <a href="index.html" class="mobile-nav-link" data-page="index">
                        <i class="ph ph-house mobile-nav-icon"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="products.html" class="mobile-nav-link" data-page="products">
                        <i class="ph ph-package mobile-nav-icon"></i>
                        <span>Prodotti</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="categorie.html" class="mobile-nav-link" data-page="categorie">
                        <i class="ph ph-folders mobile-nav-icon"></i>
                        <span>Categorie</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="cronoai.html" class="mobile-nav-link" data-page="cronoai">
                        <i class="ph ph-sparkle mobile-nav-icon"></i>
                        <span>CronoAI</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="blog.html" class="mobile-nav-link" data-page="blog">
                        <i class="ph ph-newspaper mobile-nav-icon"></i>
                        <span>Blog</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="wishlist.html" class="mobile-nav-link" data-page="wishlist">
                        <i class="ph ph-heart mobile-nav-icon"></i>
                        <span>Wishlist</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="cart.html" class="mobile-nav-link" data-page="cart">
                        <i class="ph ph-shopping-cart mobile-nav-icon"></i>
                        <span>Carrello</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="account.html" class="mobile-nav-link" data-page="account">
                        <i class="ph ph-user-circle mobile-nav-icon"></i>
                        <span>Account</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="groups.html" class="mobile-nav-link" data-page="groups">
                        <i class="ph ph-users mobile-nav-icon"></i>
                        <span>Gruppi</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="faq.html" class="mobile-nav-link" data-page="faq">
                        <i class="ph ph-question mobile-nav-icon"></i>
                        <span>FAQ</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="chisiamo.html" class="mobile-nav-link" data-page="chisiamo">
                        <i class="ph ph-info mobile-nav-icon"></i>
                        <span>Chi Siamo</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <script>
        // Navigation functionality
        class CronoshopNavigation {
            constructor() {
                this.init();
            }

            init() {
                this.setupElements();
                this.setupEventListeners();
                this.setupTheme();
                this.setupActiveLinks();
                this.updateCartBadge();
            }

            setupElements() {
                this.themeToggle = document.getElementById('themeToggle');
                this.themeIcon = document.getElementById('themeIcon');
                this.mobileMenuBtn = document.getElementById('mobileMenuBtn');
                this.closeMobileMenu = document.getElementById('closeMobileMenu');
                this.mobileMenu = document.getElementById('mobileMenu');
                this.overlay = document.getElementById('overlay');
                this.searchBtn = document.getElementById('searchBtn');
                this.cartBadge = document.getElementById('cartBadge');
                this.logoLight = document.querySelector('.logo-light');
                this.logoDark = document.querySelector('.logo-dark');
            }

            setupEventListeners() {
                // Theme toggle
                this.themeToggle?.addEventListener('click', () => this.toggleTheme());

                // Mobile menu
                this.mobileMenuBtn?.addEventListener('click', () => this.openMobileMenu());
                this.closeMobileMenu?.addEventListener('click', () => this.closeMobileMenuHandler());
                this.overlay?.addEventListener('click', () => this.closeMobileMenuHandler());

                // Search
                this.searchBtn?.addEventListener('click', () => this.handleSearch());

                // Close mobile menu on link click
                document.querySelectorAll('.mobile-nav-link').forEach(link => {
                    link.addEventListener('click', () => this.closeMobileMenuHandler());
                });

                // Handle escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeMobileMenuHandler();
                    }
                });
            }

            setupTheme() {
                const savedTheme = localStorage.getItem('cronoshop-theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = savedTheme || (prefersDark ? 'dark' : 'light');
                
                this.applyTheme(theme);
            }

            toggleTheme() {
                const isDark = document.body.classList.contains('dark-mode');
                const newTheme = isDark ? 'light' : 'dark';
                this.applyTheme(newTheme);
                localStorage.setItem('cronoshop-theme', newTheme);
                this.showNotification(isDark ? 'â˜€ï¸ Tema chiaro attivato' : 'ðŸŒ™ Tema scuro attivato');
            }

            applyTheme(theme) {
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    this.themeIcon.className = 'ph ph-sun';
                    this.logoLight.style.display = 'none';
                    this.logoDark.style.display = 'block';
                } else {
                    document.body.classList.remove('dark-mode');
                    this.themeIcon.className = 'ph ph-moon';
                    this.logoLight.style.display = 'block';
                    this.logoDark.style.display = 'none';
                }
            }

            setupActiveLinks() {
                const currentPage = window.location.pathname.split('/').pop() || 'index.html';
                const pageKey = currentPage.replace('.html', '') || 'index';
                
                // Desktop links
                document.querySelectorAll('.nav-link[data-page]').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageKey) {
                        link.classList.add('active');
                    }
                });

                // Mobile links
                document.querySelectorAll('.mobile-nav-link[data-page]').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageKey) {
                        link.classList.add('active');
                    }
                });
            }

            openMobileMenu() {
                this.mobileMenu.classList.add('is-open');
                this.overlay.classList.add('is-active');
                document.body.style.overflow = 'hidden';
            }

            closeMobileMenuHandler() {
                this.mobileMenu.classList.remove('is-open');
                this.overlay.classList.remove('is-active');
                document.body.style.overflow = '';
            }

            handleSearch() {
                // Simple search implementation - redirect to products page
                const query = prompt('ðŸ” Cosa stai cercando?');
                if (query && query.trim()) {
                    window.location.href = `products.html?search=${encodeURIComponent(query.trim())}`;
                }
            }

            updateCartBadge() {
                try {
                    const cartData = localStorage.getItem('cronoshop_cart');
                    if (cartData) {
                        const cart = JSON.parse(cartData);
                        const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
                        
                        if (totalItems > 0) {
                            this.cartBadge.textContent = totalItems > 99 ? '99+' : totalItems;
                            this.cartBadge.style.display = 'flex';
                        } else {
                            this.cartBadge.style.display = 'none';
                        }
                    } else {
                        this.cartBadge.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error updating cart badge:', error);
                    this.cartBadge.style.display = 'none';
                }
            }

            showNotification(message) {
                // Remove existing notification
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }

                // Create new notification
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = `
                    <span class="notification-icon">${message.split(' ')[0]}</span>
                    <span>${message.substring(message.indexOf(' ') + 1)}</span>
                `;

                document.body.appendChild(notification);

                // Show notification
                setTimeout(() => notification.classList.add('show'), 100);

                // Hide notification after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // Public method to update cart badge from other scripts
            refreshCartBadge() {
                this.updateCartBadge();
            }
        }

        // Initialize navigation when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.cronoshopNav = new CronoshopNavigation();
        });

        // Update cart badge when storage changes
        window.addEventListener('storage', (e) => {
            if (e.key === 'cronoshop_cart' && window.cronoshopNav) {
                window.cronoshopNav.refreshCartBadge();
            }
        });

        // Export for use in other scripts
        window.CronoshopNavigation = CronoshopNavigation;
    </script>
</body>
</html>
